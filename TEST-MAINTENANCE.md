# Test Results Maintenance Guide

This guide explains how to manage and maintain test artifacts generated by Playwright and Vitest.

## 📁 What's in test-results/

The `test-results/` folder contains artifacts generated when E2E tests fail:

- **`test-failed-1.png`** - Screenshots of failed tests
- **`video.webm`** - Video recordings of test execution
- **`trace.zip`** - Detailed traces for debugging (if enabled)
- **`error-context.md`** - Context information about test failures
- **`.last-run.json`** - Metadata about the last test run

## 🧹 Cleaning Up Test Results

### Quick Cleanup Commands

```bash
# Clean all test artifacts
npm run test:clean

# Clean only test results (screenshots, videos, traces)
npm run test:clean-results

# Clean only HTML reports
npm run test:clean-reports
```

### Manual Cleanup

```bash
# Remove specific test result folders
rm -rf test-results/critical-flows-*

# Remove old test results (older than 7 days)
find test-results/ -type d -mtime +7 -exec rm -rf {} \;

# Remove large video files
find test-results/ -name "*.webm" -size +10M -delete
```

## 🔧 Configuration Options

### Playwright Configuration

In `playwright.config.js`, you can control artifact generation:

```javascript
use: {
  // Take screenshot only on failure
  screenshot: 'only-on-failure',
  
  // Record video only on failure
  video: 'retain-on-failure',
  
  // Collect trace only on first retry
  trace: 'on-first-retry',
}
```

### Disable Artifacts for CI

For GitHub Actions, you might want to disable artifacts to save space:

```yaml
- name: Run E2E tests
  run: npm run test:e2e
  env:
    # Disable video recording in CI
    PLAYWRIGHT_VIDEO: 'off'
```

## 📊 Storage Management

### Disk Space Considerations

- **Screenshots**: ~100-500KB each
- **Videos**: ~1-10MB each (can be large)
- **Traces**: ~1-5MB each

### Recommended Cleanup Schedule

1. **After each test run**: Clean failed test artifacts
2. **Weekly**: Clean all test artifacts
3. **Before commits**: Run `npm run test:clean`

## 🚀 Best Practices

### 1. Automated Cleanup

Add to your pre-commit hook (`.husky/pre-commit`):

```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Clean test artifacts before committing
npm run test:clean-results

# Run tests...
npm run lint
npm run format
npm run test:run
```

### 2. CI/CD Cleanup

In GitHub Actions, clean up after tests:

```yaml
- name: Clean test artifacts
  if: always()
  run: npm run test:clean
```

### 3. Selective Artifact Retention

Keep artifacts only for failed tests:

```javascript
// In playwright.config.js
use: {
  screenshot: 'only-on-failure',
  video: 'retain-on-failure',
  trace: 'on-first-retry',
}
```

## 🔍 Debugging with Test Results

### Viewing Test Results

```bash
# Open HTML report
npx playwright show-report

# View specific test results
open test-results/critical-flows-*/test-failed-1.png
```

### Analyzing Failures

1. **Check screenshots** for visual issues
2. **Watch videos** to see test execution flow
3. **Use traces** for detailed debugging
4. **Read error context** for specific failure details

## 📝 Maintenance Checklist

- [ ] Add `test-results/` to `.gitignore`
- [ ] Set up automated cleanup scripts
- [ ] Configure artifact retention policies
- [ ] Monitor disk space usage
- [ ] Clean up before major commits
- [ ] Document cleanup procedures for team

## 🆘 Troubleshooting

### Large test-results/ folder

```bash
# Check folder size
du -sh test-results/

# Find largest files
find test-results/ -type f -exec ls -lh {} \; | sort -k5 -hr | head -10
```

### Permission issues

```bash
# Fix permissions
chmod -R 755 test-results/
```

### Cleanup failures

```bash
# Force cleanup
sudo rm -rf test-results/
```

## 📚 Additional Resources

- [Playwright Test Artifacts](https://playwright.dev/docs/test-artifacts)
- [Playwright Configuration](https://playwright.dev/docs/test-configuration)
- [CI/CD Best Practices](https://playwright.dev/docs/ci)
